{{/*
  The maximum article container width is set to 738px with 1.25rem padding
  (see the ".narrow-container" class), which results in the effective maximum
  image width of 698px.

  For pages in the /blog/ section we also add a magnification link.
*/}}
{{- $originalImg := or
  (.Page.Resources.Get .Destination)
  (.Page.CurrentSection.Resources.Get .Destination)
  (resources.Get .Destination)
}}
{{- $previewWidth := 698 -}}

{{- $showFullSizeLightbox := hasPrefix .Page.Path "/blog/" }}
{{- if $showFullSizeLightbox }}
  {{- $fullSizeWidth := "" }}
  {{- $fullSizeHeight := "" }}
  {{- if ne $originalImg.MediaType.SubType "svg" }}
    {{- $previewWidth2x := mul $previewWidth 2 }}
    {{- $fullSizeWidth = math.Min $originalImg.Width $previewWidth2x }}
    {{- $fullSizeHeight = int (mul $originalImg.Height (div (float $fullSizeWidth) $originalImg.Width)) }}
  {{- end }}
<a href="{{ .Destination }}" data-pswp-width="{{ $fullSizeWidth }}" data-pswp-height="{{ $fullSizeHeight }}">
{{- end }}
  {{ partial "image.html" (dict
    "Img" $originalImg
    "Alt" .Text
    "Width" $previewWidth
    ) }}
{{- if $showFullSizeLightbox }}
</a>
{{- end }}
