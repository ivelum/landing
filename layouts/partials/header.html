{{- $section := . }}
<div class="header" data-scroll-lock-fill-gap x-data="header">
  <div class="header--wrapper">
    <a
      class="header--logo{{ if eq .RelPermalink "/" }} is-disabled{{ end }}"
      href="/"
    >
      <img src="/img/logo.svg" alt="ivelum">
      {{- /* TODO: Light mode for Teamplify, Contact, and Privacy policy */}}
    </a>
    <div class="header--menu" x-bind:class="isMenuOpen && 'is-open'">
      <div class="header--menu-inner">
        <div class="header--menu-items">
          {{- $items := dict
            "/" "About"
            "/how-we-work/" "How we work"
            "/solutions/" "Solutions"
            "/teamplify/" "Teamplify"
            "/contact/" "Contact"
          }}
          {{- range $url, $text := $items }}
          <a
            class="
              {{- "header--menu-item" }}
              {{- if eq $section.RelPermalink $url }} is-active{{ end -}}
            "
            href="{{ $url }}"
            >{{ $text }}</a
          >
          {{- end }}
        </div>
        <div class="header--button-wrapper">
          <a class="header--button" x-on:click="talkToUs">
            <img src="/img/ico-talk.svg" alt="ivelum">Talk to us
          </a>
        </div>
      </div>
    </div>
    <button
      type="button"
      class="header--burger"
      x-bind:class="isMenuOpen && 'is-open'"
      x-on:click="toggleMenu"
      aria-label="Menu"
    >
      <span />
    </button>
  </div>
</div>

<script>
{
  const mediaMd = '(min-width: 768px)';

  document.addEventListener('alpine:init', () => {
    Alpine.data('header', () => ({
      isMenuOpen: false,

      init() {
        this.handleWidthChange = this.handleWidthChange.bind(this);
        this.checkMediaMd = window.matchMedia(mediaMd);
        this.checkMediaMd.addEventListener('change', this.handleWidthChange);
      },

      destroy() {
        this.checkMediaMd.removeEventListener('change', this.handleWidthChange);
      },

      handleWidthChange(e) {
        if (e.matches) this.closeMenu();
      },

      closeMenu() {
        this.isMenuOpen = false;
        scrollLock.enablePageScroll();
      },

      openMenu() {
        this.isMenuOpen = true;
        scrollLock.disablePageScroll();
      },

      toggleMenu() {
        (this.isMenuOpen) ? this.closeMenu() : this.openMenu();
      },

      talkToUs() {
        this.closeMenu();
        window.talk.scrollIntoView({ behavior: 'smooth' });
        document.querySelector('.form-control-textarea')?.focus();
      },
    }));
  });
}
</script>
